<!DOCTYPE html>
<html lang="en-CA">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Databricks MLFlow: AutoML and Experiments | Federal Science DataHub</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="shortcut icon" href="https://notification.canada.ca/static/images/favicon.ico">
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-KRKRZQV');
    </script>
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-R04KFLQCVQ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-R04KFLQCVQ', {anonymize_ip: true});
    </script>
    <meta name="description" content="Learn how to use the FSDH platform">
    <meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.b59c7f1d.css" as="style"><link rel="preload" href="/assets/js/app.0a2a5975.js" as="script"><link rel="preload" href="/assets/js/4.dafd24fd.js" as="script"><link rel="preload" href="/assets/js/2.d936b15f.js" as="script"><link rel="preload" href="/assets/js/1.19ca758f.js" as="script"><link rel="preload" href="/assets/js/21.06973a16.js" as="script"><link rel="prefetch" href="/assets/js/10.a6457c3f.js"><link rel="prefetch" href="/assets/js/100.85215be8.js"><link rel="prefetch" href="/assets/js/101.f4d3c114.js"><link rel="prefetch" href="/assets/js/102.43e0af8e.js"><link rel="prefetch" href="/assets/js/103.4aa134e8.js"><link rel="prefetch" href="/assets/js/104.89b1f352.js"><link rel="prefetch" href="/assets/js/105.2c7257da.js"><link rel="prefetch" href="/assets/js/106.28828cb7.js"><link rel="prefetch" href="/assets/js/107.03894f46.js"><link rel="prefetch" href="/assets/js/108.976afe8f.js"><link rel="prefetch" href="/assets/js/109.e919eb71.js"><link rel="prefetch" href="/assets/js/11.6740aaf5.js"><link rel="prefetch" href="/assets/js/110.d4d4e55b.js"><link rel="prefetch" href="/assets/js/111.73622971.js"><link rel="prefetch" href="/assets/js/112.725353e9.js"><link rel="prefetch" href="/assets/js/113.b9e523ad.js"><link rel="prefetch" href="/assets/js/114.695b89bf.js"><link rel="prefetch" href="/assets/js/115.8a6e0ff6.js"><link rel="prefetch" href="/assets/js/116.eba46494.js"><link rel="prefetch" href="/assets/js/117.ac90ecf2.js"><link rel="prefetch" href="/assets/js/118.ab71ed8f.js"><link rel="prefetch" href="/assets/js/119.a56c547d.js"><link rel="prefetch" href="/assets/js/12.95218709.js"><link rel="prefetch" href="/assets/js/120.6ef9b6df.js"><link rel="prefetch" href="/assets/js/121.3b66427f.js"><link rel="prefetch" href="/assets/js/122.fca01062.js"><link rel="prefetch" href="/assets/js/13.efb9ce07.js"><link rel="prefetch" href="/assets/js/14.a9ccf8ab.js"><link rel="prefetch" href="/assets/js/15.d6b231bc.js"><link rel="prefetch" href="/assets/js/16.d6bef624.js"><link rel="prefetch" href="/assets/js/17.3422d1e8.js"><link rel="prefetch" href="/assets/js/18.cd78629b.js"><link rel="prefetch" href="/assets/js/19.cec6d776.js"><link rel="prefetch" href="/assets/js/20.80d382c5.js"><link rel="prefetch" href="/assets/js/22.c21d3b36.js"><link rel="prefetch" href="/assets/js/23.a59c3ee7.js"><link rel="prefetch" href="/assets/js/24.c4769d6f.js"><link rel="prefetch" href="/assets/js/25.12bad863.js"><link rel="prefetch" href="/assets/js/26.25d769e7.js"><link rel="prefetch" href="/assets/js/27.21c948be.js"><link rel="prefetch" href="/assets/js/28.518a3878.js"><link rel="prefetch" href="/assets/js/29.1f44630f.js"><link rel="prefetch" href="/assets/js/3.483d7c3c.js"><link rel="prefetch" href="/assets/js/30.7287f1ad.js"><link rel="prefetch" href="/assets/js/31.e9b3e747.js"><link rel="prefetch" href="/assets/js/32.e00610a0.js"><link rel="prefetch" href="/assets/js/33.56eb8b8a.js"><link rel="prefetch" href="/assets/js/34.0385d86b.js"><link rel="prefetch" href="/assets/js/35.8a232afb.js"><link rel="prefetch" href="/assets/js/36.6df5f29e.js"><link rel="prefetch" href="/assets/js/37.5cbf2e6f.js"><link rel="prefetch" href="/assets/js/38.a3491c11.js"><link rel="prefetch" href="/assets/js/39.e690063b.js"><link rel="prefetch" href="/assets/js/40.88a5993f.js"><link rel="prefetch" href="/assets/js/41.6bddbde1.js"><link rel="prefetch" href="/assets/js/42.5d460257.js"><link rel="prefetch" href="/assets/js/43.b9f67c15.js"><link rel="prefetch" href="/assets/js/44.cec63df2.js"><link rel="prefetch" href="/assets/js/45.8529b952.js"><link rel="prefetch" href="/assets/js/46.322ca9f6.js"><link rel="prefetch" href="/assets/js/47.0f77804b.js"><link rel="prefetch" href="/assets/js/48.19ec2f28.js"><link rel="prefetch" href="/assets/js/49.17254e9d.js"><link rel="prefetch" href="/assets/js/5.de5a16ea.js"><link rel="prefetch" href="/assets/js/50.cde4e83f.js"><link rel="prefetch" href="/assets/js/51.14540eb0.js"><link rel="prefetch" href="/assets/js/52.93f35e88.js"><link rel="prefetch" href="/assets/js/53.7c049f09.js"><link rel="prefetch" href="/assets/js/54.f7eaa9b3.js"><link rel="prefetch" href="/assets/js/55.9bb7e324.js"><link rel="prefetch" href="/assets/js/56.89680b5f.js"><link rel="prefetch" href="/assets/js/57.d23a36a0.js"><link rel="prefetch" href="/assets/js/58.d6ecf109.js"><link rel="prefetch" href="/assets/js/59.2413f3e8.js"><link rel="prefetch" href="/assets/js/6.284aa379.js"><link rel="prefetch" href="/assets/js/60.2ba7e1f1.js"><link rel="prefetch" href="/assets/js/61.cbf7ddc5.js"><link rel="prefetch" href="/assets/js/62.b67746c5.js"><link rel="prefetch" href="/assets/js/63.f36d1c36.js"><link rel="prefetch" href="/assets/js/64.de418901.js"><link rel="prefetch" href="/assets/js/65.3a78e7ab.js"><link rel="prefetch" href="/assets/js/66.80284f76.js"><link rel="prefetch" href="/assets/js/67.f490b3ba.js"><link rel="prefetch" href="/assets/js/68.b254c0db.js"><link rel="prefetch" href="/assets/js/69.aa02899e.js"><link rel="prefetch" href="/assets/js/7.efe1ac00.js"><link rel="prefetch" href="/assets/js/70.e0e43c6d.js"><link rel="prefetch" href="/assets/js/71.3221c5c3.js"><link rel="prefetch" href="/assets/js/72.574b88f9.js"><link rel="prefetch" href="/assets/js/73.64d1967a.js"><link rel="prefetch" href="/assets/js/74.01b0b059.js"><link rel="prefetch" href="/assets/js/75.090dd2bd.js"><link rel="prefetch" href="/assets/js/76.1d10e016.js"><link rel="prefetch" href="/assets/js/77.b1dcc79d.js"><link rel="prefetch" href="/assets/js/78.8aaf44d8.js"><link rel="prefetch" href="/assets/js/79.f99b4e0b.js"><link rel="prefetch" href="/assets/js/80.e39c8290.js"><link rel="prefetch" href="/assets/js/81.7dddd1df.js"><link rel="prefetch" href="/assets/js/82.395a2825.js"><link rel="prefetch" href="/assets/js/83.b185e39e.js"><link rel="prefetch" href="/assets/js/84.35f95fbd.js"><link rel="prefetch" href="/assets/js/85.95561e16.js"><link rel="prefetch" href="/assets/js/86.0b07522e.js"><link rel="prefetch" href="/assets/js/87.901a36a7.js"><link rel="prefetch" href="/assets/js/88.3e2a6405.js"><link rel="prefetch" href="/assets/js/89.2a223f71.js"><link rel="prefetch" href="/assets/js/90.f6847e6f.js"><link rel="prefetch" href="/assets/js/91.459f47c4.js"><link rel="prefetch" href="/assets/js/92.59af99f3.js"><link rel="prefetch" href="/assets/js/93.777ed24e.js"><link rel="prefetch" href="/assets/js/94.cbf13135.js"><link rel="prefetch" href="/assets/js/95.e872f001.js"><link rel="prefetch" href="/assets/js/96.bf6c7db8.js"><link rel="prefetch" href="/assets/js/97.b56a229d.js"><link rel="prefetch" href="/assets/js/98.5684704f.js"><link rel="prefetch" href="/assets/js/99.e94a4089.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d128eee5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b59c7f1d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KRKRZQV" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><div class="logo-and-title"><img src="https://assets.notification.canada.ca/static/gov-canada-en.svg" alt="Federal Science DataHub" class="logo"> <div class="site-name"><h2>Federal Science DataHub</h2></div></div></a> <div class="links"><div class="search-box"><input aria-label="Search" type="search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide nav-links"><div class="nav-item"><a href="/fr/databricks/Expériences-Automl.html" class="nav-link">
  Français
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fr/databricks/Expériences-Automl.html" class="nav-link">
  Français
</a></div> <!----></nav> <div class="back-to-notify"><a href="https://federal-science-datahub.canada.ca/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Back to the FSDH
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <ul class="sidebar-links"><li><a href="/en/" aria-current="page" class="sidebar-link">Overview</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/en/managing-workspaces-and-users" class="sidebar-heading clickable"><span>Managing Workspaces and Users</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en/migration" class="sidebar-heading clickable"><span>Migrating to Production</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en/storage" class="sidebar-heading clickable"><span>Storage</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en/databricks" class="sidebar-heading clickable router-link-active open"><span>Databricks</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/databricks/Databricks-101.html" class="sidebar-link">Getting Started with Databricks</a></li><li><a href="/en/databricks/Cluster-Policies.html" class="sidebar-link">FSDH Cluster Policies</a></li><li><a href="/en/databricks/Git-Integration.html" class="sidebar-link">Git/GitHub Integration with Databricks</a></li><li><a href="/en/databricks/vscode_extension.html" class="sidebar-link">Databricks VS Code Extension</a></li><li><a href="/en/databricks/Conda-Packages.html" class="sidebar-link">Working with Conda</a></li><li><a href="/en/databricks/Connecting-Google-API.html" class="sidebar-link">Connecting Google API to Databricks</a></li><li><a href="/en/databricks/Dashboarding.html" class="sidebar-link">How to Dashboard in Databricks</a></li><li><a href="/en/databricks/Dashboarding-Tool-Comparison.html" class="sidebar-link">Dashboarding Tool Comparison</a></li><li><a href="/en/databricks/Experiments-Automl.html" aria-current="page" class="active sidebar-link">Databricks MLFlow: AutoML and Experiments</a></li><li><a href="/en/databricks/Workflows.html" class="sidebar-link">Databricks Workflows</a></li><li><a href="/en/databricks/Databricks-FAQ.html" class="sidebar-link">Databricks Frequently Asked Questions</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en/postgresql" class="sidebar-heading clickable"><span>PostgreSQL</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en/apps" class="sidebar-heading clickable"><span>Web Applications</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/en/guidance" class="sidebar-heading clickable"><span>User Guidance</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/en/Terms-And-Conditions.html" class="sidebar-link">Terms and Conditions</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="databricks-mlflow-automl-and-experiments"><a href="#databricks-mlflow-automl-and-experiments" aria-hidden="true" tabindex="-1" class="header-anchor">#</a> <strong>Databricks MLFlow: AutoML and Experiments</strong></h1> <p>Databricks MLFlow is an integrated platform for the end-to-end machine learning lifecycle. It provides a centralized place to track experiments, manage models, and quickly deploy them into production. MLflow lets you log and query experiments using Python, REST, R API, and Java API APIs. You can use MLflow to record and query experiments, get run metrics, metrics history, and compare runs. MLflow is an API and UI for logging parameters, code versions, metrics, and output files when running your machine learning code and for later visualizing the results.</p> <p>MLflow is organized around the concept of <strong>runs</strong>, which are executions of data science code. Runs are aggregated into <strong>experiments</strong> where many runs can be a part of a given experiment and an MLflow server can host many experiments. The MLflow component is an API and UI for logging parameters, code versions, metrics, and output files when running your machine learning code and for later visualizing the results.</p> <p>In Databricks, there are two types of experiments:</p> <ul><li><strong>Workspace experiments</strong> are experiments that are created and managed in the Databricks workspace. You can use the Databricks experiment UI to view and manage these experiments. You can also use the MLflow API to log runs to these experiments.</li> <li><strong>Notebook experiments</strong> are experiments that are created and managed in a notebook. You can use the MLflow API to log runs to these experiments. You can also use the Databricks experiment UI to view and manage these experiments.</li></ul> <h2 id="workspace-experiments-and-automl"><a href="#workspace-experiments-and-automl" aria-hidden="true" tabindex="-1" class="header-anchor">#</a> <strong>Workspace Experiments and AutoML</strong></h2> <p>Workspace experiments take advantage of AutoML, which is a feature of Databricks that automatically trains and tunes machine learning models. This allows user to build machine learning models with minimal effort and near no coding required. This feature is an out-of-the-box option for Databricks and it offers a variety of algorithms to choose from:</p> <ul><li><strong>Classification</strong>: Logistic Regression, Random Forest, Decision Tree, XGBoost, LightGBM</li> <li><strong>Regression</strong>: Decision Tree, Random Forest, Linear Regresseion with stochastic gradient descent, XGBoost, LightGBM</li> <li><strong>Forecasting</strong>: ARIMA, Prophet</li></ul> <p>In summary, AutoML will train several models using different algorithms and hyperparameters and select the best one based on the metric you choose. It will also provide you with a notebook that you can use to deploy your model.</p> <p>The first step to using AutoML is to upload your training data to Databricks. You can do so by following <a href="https://learn.microsoft.com/en-us/azure/databricks/ingestion/add-data/upload-data" target="_blank" rel="noopener noreferrer">this guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. You will also need a cluster with a ML runtime.</p> <p>Once you have your data uploaded, you can create a new experiment by clicking on the <code>Experiments</code> tab on the left side of the screen. If you are using the old UI, you need to select &quot;Machine Learning&quot; from the top left dropdown menu.</p> <p>Old UI:
<img src="/assets/img/Experiments-OldUIExp.128063ef.png" alt="Alt text"></p> <p>New UI:
<img src="/assets/img/Experiments-NewUIExp.10097634.png" alt="Alt text"></p> <p>Once you've accessed the experiment page, you can click on the <code>New Experiment</code> button to create a new experiment:</p> <p><img src="/assets/img/Experiments-CreateExp.d2500c2f.png" alt="Alt text">
This will open the experiment creation menu:</p> <p><img src="/assets/img/Experiments-ExpMenu.989a3e84.png" alt="Alt text"></p> <p>From there, you can configure your experiment. Certain configurations will be available only for certain ML problem types. The configurations are as follows:</p> <ul><li><strong>Cluster</strong>: the cluster you want to use for the experiment, as mentioned above, it must be a cluster with a ML runtime and it must be currently running.</li> <li><strong>ML problem type</strong>: the type of problem you are trying to solve, either classification, regression or forecasting.</li> <li><strong>Input training dataset</strong>: the dataset you want to use for training. As mentioned above, your data must be available within Databricks' SQL database.</li> <li><strong>Prediction target</strong>: the column/feature you are attempting to predict.</li> <li><strong>Experiment name</strong>: the name of your experiment.</li></ul> <p>There are also advanced configurations where you can specify the following:</p> <p><img src="/assets/img/Experiments-AdvancedConfig.f7be2044.png" alt="Alt text"></p> <ul><li><strong>Evaluation metric</strong>: the metric you want to use to evaluate your model. This will be used to compare models and select the best one. The metric you choose must be available for the problem type you selected.</li> <li><strong>Training frameworks</strong>: the frameworks you want to use for training. Depending on your problem type, you will be able to choose from the list given above. Note that you can select several frameworks at once.</li> <li><strong>Timeout</strong>: the maximum amount of time you want to allow for training. If the training time exceeds this value, the training will be stopped and the best model will be selected.</li></ul> <p>As well as other configurations.</p> <p>Once you have configured your experiment, you can click on the <code>Start AutoML</code> button to create it. This will take you to overview page, where you can see the progress of your experiment:</p> <p><img src="/assets/img/Experiments-ExpOverview.592c3503.png" alt="Alt text"></p> <p>At the top, you can see general information about your experiment, you can view an auto-generated data exploration notebook and you can view the best model's notebook. You can also see the status of your experiment and the number of models that have been trained so far. At the bottom, you can see more information about the models that have been trained, including the model's name, the framework used, the training time, the metric value and the status.</p> <p>Once your experiment is over, your models will be sorted by the error metric you chose, and as such you can then select the best model from the list. By clicking on it, you can register the model:</p> <p><img src="/assets/img/Experiments-RegisterModel.3122f9a2.png" alt="Alt text"></p> <p>You will be prompted to select a name for your model, then you can click on <code>Create</code>.</p> <p>From this point onward, the model you have created will be available to whoever you give permissions to from the <code>Models</code> tab on the left side of the screen:</p> <p><img src="/assets/img/Experiments-ModelTab.477444ad.png" alt="Alt text"></p> <p>Upon clicking on a registered model, you will be able to see its details:</p> <p><img src="/assets/img/Experiments-RegisteredModel.3763abd2.png" alt="Alt text">
From there you can set it's stage, such as <code>Production</code>, <code>Staging</code> or <code>Archived</code>. You can also view the model's version history, which will show you the different versions of the model that have been created. You can also view the model's lineage, which will show you the different experiments that have been used to create the model.</p> <p>On top of this, you can click on <code>Use model for inference</code> to auto-generate notebooks that can be used for using the model to infer or automatically apply the model to any available datasets.</p> <p><em>Congrats!</em> You have successfully created a model using AutoML and registered it for future use, without writing any code!</p> <h2 id="notebook-experiments"><a href="#notebook-experiments" aria-hidden="true" tabindex="-1" class="header-anchor">#</a> <strong>Notebook Experiments</strong></h2> <p>Notebook experiments are experiments that are created and managed in a notebook. These are great if you require very specific machine learning code and if you need to do pre- or post-processing.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># mlflow.start_run creates a new MLflow run to track the performance of this model.</span>
<span class="token comment"># Within the context, you call mlflow.log_param to keep track of the parameters used, and</span>
<span class="token comment"># mlflow.log_metric to record metrics like accuracy.</span>
<span class="token keyword">with</span> mlflow<span class="token punctuation">.</span>start_run<span class="token punctuation">(</span>run_name<span class="token operator">=</span><span class="token string">'untuned_random_forest'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  n_estimators <span class="token operator">=</span> <span class="token number">10</span>
  model <span class="token operator">=</span> RandomForestClassifier<span class="token punctuation">(</span>n_estimators<span class="token operator">=</span>n_estimators<span class="token punctuation">,</span> random_state<span class="token operator">=</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>RandomState<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> y_train<span class="token punctuation">)</span>

  <span class="token comment"># predict_proba returns [prob_negative, prob_positive], so slice the output with [:, 1]</span>
  predictions_test <span class="token operator">=</span> model<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span>X_test<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
  auc_score <span class="token operator">=</span> roc_auc_score<span class="token punctuation">(</span>y_test<span class="token punctuation">,</span> predictions_test<span class="token punctuation">)</span>
  mlflow<span class="token punctuation">.</span>log_param<span class="token punctuation">(</span><span class="token string">'n_estimators'</span><span class="token punctuation">,</span> n_estimators<span class="token punctuation">)</span>
  <span class="token comment"># Use the area under the ROC curve as a metric.</span>
  mlflow<span class="token punctuation">.</span>log_metric<span class="token punctuation">(</span><span class="token string">'auc'</span><span class="token punctuation">,</span> auc_score<span class="token punctuation">)</span>
  wrappedModel <span class="token operator">=</span> SklearnModelWrapper<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
  <span class="token comment"># Log the model with a signature that defines the schema of the model's inputs and outputs.</span>
  <span class="token comment"># When the model is deployed, this signature will be used to validate inputs.</span>
  signature <span class="token operator">=</span> infer_signature<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span> wrappedModel<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> X_train<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment"># MLflow contains utilities to create a conda environment used to serve models.</span>
  <span class="token comment"># The necessary dependencies are added to a conda.yaml file which is logged along with the model.</span>
  conda_env <span class="token operator">=</span>  _mlflow_conda_env<span class="token punctuation">(</span>
        additional_conda_deps<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
        additional_pip_deps<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&quot;cloudpickle=={}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>cloudpickle<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;scikit-learn=={}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sklearn<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        additional_conda_channels<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
  mlflow<span class="token punctuation">.</span>pyfunc<span class="token punctuation">.</span>log_model<span class="token punctuation">(</span><span class="token string">&quot;random_forest_model&quot;</span><span class="token punctuation">,</span> python_model<span class="token operator">=</span>wrappedModel<span class="token punctuation">,</span> conda_env<span class="token operator">=</span>conda_env<span class="token punctuation">,</span> signature<span class="token operator">=</span>signature<span class="token punctuation">)</span>
</code></pre></div><p>Above is an example of how to use experiments from within Python notebooks. This example is taken from the <a href="https://learn.microsoft.com/en-us/azure/databricks/mlflow/end-to-end-example" target="_blank" rel="noopener noreferrer">Databricks documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>By opening the <code>mlflow.start_run</code> context, you can log parameters and metrics to the experiment. You can also log the model itself! This will allow you to register the model for future use, just like as shown in the &quot;Workbook Experiments&quot; section.</p> <p>Running this code will automatically create an experiment for you, which you can access in the <code>Experiments</code> tab on the left side of the screen, and each run you create will be added to that experiment. You can also view all the runs you have created in a notebook by clicking the <code>MLFlow experiments</code> icon on the right hand side:</p> <p><img src="/assets/img/Experiments-ExpIcon.573e4ab3.png" alt="Alt text"></p> <p>From there, you can view your runs, their associated models, their logged parameters and metrics:</p> <p><img src="/assets/img/Experiments-LoggedRuns.31a6c26f.png" alt="Alt text">
Again, make sure to check out the <a href="https://learn.microsoft.com/en-us/azure/databricks/mlflow/end-to-end-example" target="_blank" rel="noopener noreferrer">end-to-end ML example notebook<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as well as the <a href="https://docs.databricks.com/api/azure/workspace/experiments" target="_blank" rel="noopener noreferrer">MLFlow databricks API documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to learn more about how to run experiments from within notebooks.</p> <h2 id="learn-more"><a href="#learn-more" aria-hidden="true" tabindex="-1" class="header-anchor">#</a> Learn more</h2> <ul><li><a href="https://learn.microsoft.com/en-us/azure/databricks/mlflow/" target="_blank" rel="noopener noreferrer">Databricks MLFlow documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://learn.microsoft.com/en-us/azure/databricks/mlflow/end-to-end-example" target="_blank" rel="noopener noreferrer">Notebook experiment example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ssc-sp/fsdh-pfds-docs/edit/main/src/en/databricks/Experiments-Automl.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub (opens in a new tab)</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last updated:</span> <span class="time">2026-01-05</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/databricks/Dashboarding-Tool-Comparison.html" class="prev">
        Dashboarding Tool Comparison
      </a></span> <span class="next"><a href="/en/databricks/Workflows.html">
        Databricks Workflows
      </a>
      →
    </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0a2a5975.js" defer></script><script src="/assets/js/4.dafd24fd.js" defer></script><script src="/assets/js/2.d936b15f.js" defer></script><script src="/assets/js/1.19ca758f.js" defer></script><script src="/assets/js/21.06973a16.js" defer></script>
  </body>
</html>
